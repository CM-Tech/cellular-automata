<!DOCTYPE html>
<html>

    <head>
        <script src="jquery-1.12.4.min.js"></script>
        <script src="mousetrap.min.js"></script>
        <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet">
        <link href="Celly.css" rel="stylesheet">
        <script src="Filesaver.js"></script>
        <script src="drivefilepicker.js"></script>
        <script>
            function initPicker() {
                var picker = new FilePicker({
                        apiKey: 'AIzaSyAnnMlYPCRAoxACUYS86GF3FH5gk_9iqag',
                        clientId: 411044250671,
                        buttonEl: document.getElementById('pick'),
                        onSelect: function(file) {
                            console.log(file);
                            alert('Selected ' + file.title);
                        }
                    });
            }

            function download(text) {
                var cellArray = [];
                var saveString = "";
                for (var cell in cells) {

                    if (cell.substr(0, 3) == "POS") {
                        cellArray = cellArray.concat([cells[cell].x + "," + cells[cell].y + "," + cells[cell].s]);
                    }
                }
                cellArray.sort(compare);
                var file = new Blob([cellArray.join("|")], {
                        type: 'text'
                    });
                //window.open(URL.createObjectURL(file));
                saveAs(file, "Cells.txt");

            }
            var w = $("body").width();
            var h = $("body").height();
            var dragging = false;
            var mouseX = 0;
            var mouseY = 0;

var paintColor=1;
var paintMode=true;
var toolMode="pencil";
var selection={on:false,start:{x:0,y:0},end:{x:0,y:0}};
var pasting=false;
            function startDrag(event) {
                //console.log("drag");
                dragging = true;
                mouseX = (event.pageX - $('#c').offset().left) + $(window).scrollLeft();
                mouseY = (event.pageY - $('#c').offset().top) + $(window).scrollTop();
                var gridX = Math.floor((mouseX - w / 2 + scrollX * zoom) / 10 / zoom);
                var gridY = Math.floor((mouseY - h / 2 + scrollY * zoom) / 10 / zoom);
                if(toolMode=="pencil"){


                if (cells["POS" + gridX + "_" + gridY] != null) {
                    if (cells["POS" + gridX + "_" + gridY].s === paintColor) {
                        // cells[gridX+","+gridY]=null;
                        delete cells["POS" + gridX + "_" + gridY];

                        paintMode=false;
                    } else if (cells["POS" + gridX + "_" + gridY].s != 0) {
                        cells["POS" + gridX + "_" + gridY] = {
                            x: gridX,
                            y: gridY,
                            s: paintColor
                        };
                        paintMode=true;

                    }
                } else {
                    cells["POS" + gridX + "_" + gridY] = {
                        x: gridX,
                        y: gridY,
                        s: paintColor
                    };
                    paintMode=true;
                }
              }else if(toolMode=="pick"){
                if (cells["POS" + gridX + "_" + gridY] != null) {
                    if (cells["POS" + gridX + "_" + gridY].s != 0) {

                        selectColor(cells["POS" + gridX + "_" + gridY].s);

                    }
                } else {
                    selectColor(0);
                }
              }else if(toolMode=="select"){
selection.on=true;
selection.start.x=gridX;
selection.start.y=gridY;
selection.end.x=gridX;
selection.end.y=gridY;
              }
                //console.log(cells);
            }
function drawWithMouse(x,y){


      var gridX = Math.floor((x - w / 2 + scrollX * zoom) / 10 / zoom);
      var gridY = Math.floor((y - h / 2 + scrollY * zoom) / 10 / zoom);
      if (cells["POS" + gridX + "_" + gridY] != null) {


          if (paintColor === 0 || (!paintMode)) {
              delete cells["POS" + gridX + "_" + gridY];
          } else {
              cells["POS" + gridX + "_" + gridY] = {
                  x: gridX,
                  y: gridY,
                  s: paintColor
              };
          }

      } else {
          if (paintColor === 0 || (!paintMode)) {

          } else {
              cells["POS" + gridX + "_" + gridY] = {
                  x: gridX,
                  y: gridY,
                  s: paintColor
              };
          }
      }

}
            function drag(event) {

                if (dragging && !pasting) {
                  var oldMouseX=mouseX+0;
                  var oldMouseY=mouseY+0;
                    mouseX = (event.pageX - $('#c').offset().left) + $(window).scrollLeft();
                    mouseY = (event.pageY - $('#c').offset().top) + $(window).scrollTop();
                    var diff={x:mouseX-oldMouseX,y:mouseY-oldMouseY};
                    var dist=Math.sqrt(diff.x*diff.x+diff.y+diff.y);
                    if(toolMode=="pencil"){
                    for(var i=0;i<1;i+=1.0/dist){
                      drawWithMouse(oldMouseX+diff.x*i,oldMouseY+diff.y*i);
                    }
                  }else if(toolMode=="pick"){

                  }else if(toolMode=="move"){
scrollX-=diff.x/zoom;
scrollY-=diff.y/zoom;
                  }else if(toolMode=="select"){
                    var gridX = Math.floor((mouseX - w / 2 + scrollX * zoom) / 10 / zoom);
                    var gridY = Math.floor((mouseY - h / 2 + scrollY * zoom) / 10 / zoom);
    selection.end.x=gridX;
    selection.end.y=gridY;
                  }
                } else {
                    mouseX = (event.pageX - $('#c').offset().left) + $(window).scrollLeft();
                    mouseY = (event.pageY - $('#c').offset().top) + $(window).scrollTop();
                    if(selection.end.x * 10-selection.start.x * 10===0 && selection.end.y * 10-selection.start.y * 10===0){
                      selection.on=false;
                    }
                }
                //console.log(cells);
            }

            function whenMove(event) {
                mouseX = (event.pageX - $('#c').offset().left) + $(window).scrollLeft();
                mouseY = (event.pageY - $('#c').offset().top) + $(window).scrollTop();
            }
            function mouseUp(){
              if (pasting) {
                paste();
              }
              dragging=false;
            }
        </script>
        <script src="https://www.google.com/jsapi?key=PUT_YOUR_API_KEY_HERE"></script>
        <script src="https://apis.google.com/js/client.js?onload=initPicker"></script>



        <style>
        </style>
        <link rel="stylesheet" type="text/css" href="boot.css">
        <link rel="stylesheet" type="text/css" href="DriveApp.css">
        <link rel="stylesheet" type="text/css" href="style.css">
        <title>Cellular Automaton</title>
        <link rel="icon" type="image/png" href="https://github.com/modderme123/cellular-automaton/blob/gh-pages/Glider.png">
    </head>

    <body>
        <div class="drive-bar">
            <div style="position: absolute; overflow: hidden; left: 75px; top: 0px; right: 25%; height: 34px;">
                <table cellspacing="0" cellpadding="0" style="position: absolute; left: 0px; top: 0px; right: 0px; bottom: 0px;">
                    <tbody>
                        <tr>
                            <td align="left" style="vertical-align: top;">
                                <div class="fsc-DocumentName fsc-EditableDocumentName">Cellular Automaton</div>
                            </td>
                            <td align="left" style="vertical-align: top;">
                                <div class="fsc-DocumentName">/</div>
                            </td>
                            <td align="left" style="vertical-align: top;">
                                <div class="fsc-DocumentName fsc-EditableDocumentName rule-name">B4S4 Extended Moore</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div style="position: absolute; overflow: hidden; left: 0px; top: 0px; width: 60px; height: 60px;">
                <div tabindex="0" style="position: absolute; left: 0px; top: 0px; right: 0px; bottom: 0px;">
                    <input type="text" tabindex="-1" role="presentation" style="opacity: 0; height: 1px; width: 1px; z-index: -1; overflow: hidden; position: absolute;">
                    <div class="fsc-FontIcon fsc-DrivePanel" style="position: relative; overflow: hidden; width: 60px; height: 60px; background-color: rgb(86, 97,225);">

                        <div class="fsc-FontIcon fsc-AppIcon the-icon" style="position: absolute; left: 8px; top: 8px;">
                            <img src="Glider.png">
                        </div>

                    </div>
                </div>
            </div>
            <div style="position: absolute; overflow: visible; left: 0px; top: 29px; right: 250px; height: 35px;">
                <table cellspacing="0" cellpadding="0" style="position: absolute; left: 0px; top: 0px; right: 0px; bottom: 0px;">
                    <tbody>
                        <tr>
                            <td align="left" style="vertical-align: top;">
                                <div tabindex="0" role="menubar" class="gwt-MenuBar gwt-MenuBar-horizontal" hidefocus="true" aria-activedescendant="gwt-uid-1" style="outline: 0px;">
                                    <input type="text" tabindex="-1" role="presentation" style="opacity: 0; height: 1px; width: 1px; z-index: -1; overflow: hidden; position: absolute;">
                                    <table>
                                        <tbody>
                                            <tr>
                                                <td class="gwt-MenuItem" id="gwt-uid-1" role="menuitem" aria-haspopup="true">File<div class="menu-popup">
                                                  <div class="menu-popup-item" onclick="savePattern()">Save</div>
                                                  <div class="menu-popup-item" onclick="document.getElementById('file-open-input').click()">Open<input id="file-open-input" type="file" onchange="loadAndOpenFile()"></div>
                                                </div></td>
                                                <td class="gwt-MenuItem" id="gwt-uid-30" role="menuitem" aria-haspopup="true">Edit<div class="menu-popup">
                                                  <div class="menu-popup-item" onclick="cut()">Cut</div>
                                                  <div class="menu-popup-item" onclick="copy()">Copy</div>
                                                  <div class="menu-popup-item" onclick="startPaste()">Paste</div>
                                                </div></td>
                                                <td class="gwt-MenuItem" id="gwt-uid-35" role="menuitem" aria-haspopup="true">View</td>
                                                <td class="gwt-MenuItem" id="gwt-uid-37" role="menuitem" aria-haspopup="true">Help</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </td>
                            <td align="left" style="vertical-align: top;">
                                <div class="fsc-SaveLabel"></div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <!--div id="overlay"-->
        <div class="options-container fse-EditorPanel">
            <div class="fs-Toolbar options-toolbar" style="">

                <div class="fsc-DocumentName" style="vertical-align: middle;text-align:center;margin-top:2px">Options</div>

            </div>

            <div class="options">
                <div class="options-section-sub" style="border-top:none">Stats
                </div>
                 <div class="cell-num" style="margin-bottom:10px"></div>
                 <div class="cell-gen" style="margin-bottom:10px">Generation:</div>
                <div class="options-section-sub">Rule
                </div>


                <select id="rules" class="form-control btn-danger" onchange="selectRule()">
                    <option value="ExtendedMooreB4S4" selected>ExtendedMooreB4S4</option>
                    <option value="ExtendedMooreB56S45">ExtendedMooreB56S45</option>
                    <option value="Extended2MooreB10S10">Extended2MooreB10S10</option>
                    <option value="HexB4S4">HexB4S4</option>
                    <option value="ColeRule">ColeRule</option>
                    <option value="PersianCarpet">PersianCarpet</option>
                    <option value="Life">Life</option>
                    <option value="Life2">Life2</option>
                    <option value="RPS">Rock Paper Scissors</option>
                    <option value="Caves">Caves</option>
                    <option value="infexpand">Infinite Expander</option>
                </select>
                <div class="options-section-sub">Controls
                </div>
                <div class="btn-group running-group">
                    <!--<input id="run-toggle" type="checkbox" data-toggle="toggle" onclick="toggleCalc()" data-on="Stop" data-off="Play">-->

                    <button id="clear-button" type="button" class="btn btn-info" onclick="clearCells()">Clear</button>
                    <button id="step-button" type="button" class="btn btn-warning" onclick="calc()">Step</button>
                </div>

                <div class="btn-group running-group">

                    <button id="log-button" type="button" class="btn btn-info" onclick="console.log(cells)">Log</button>
                    <button id="random-button" type="button" class="btn btn-danger" onclick="randomCells()">Random</button>
                </div>


                <div class="options-section-sub">Input/Output</div>

                <button id="save-button" type="button" class="btn btn-default btn-warning" onclick="savePattern()">Save</button>
                <button id="make-hash-button" type="button" onclick="makehash()" class="btn btn-success">Create Hash Url</button>
                <div class="fileupload fileupload-new" data-provides="fileupload">
                     <span class="btn btn-primary btn-file"><span class="fileupload-new">Select file</span>
                     <span class="fileupload-exists">Change</span>
                    <input type="file" onchange="loadFileAsText()" />
                    </span>
                     <span class="fileupload-preview"></span>
                     <a href="#" class="close fileupload-exists" data-dismiss="fileupload" onchange="loadFileAsText()" style="float: none">x</a>
                </div>


                <input class="form-control btn-danger" type="text" id="inputTextToSave" value="3,-2,3|1,-3,3|4,-2,3|5,-3,3|5,-5,3|4,-6,3|2,-6,3|1,-5,3|3,-4,3|2,-2,3|1,-4,3|5,-4,3|3,-12,3|4,-3,2|3,-8,2|9,2466,2|3,-3,1|3,-9,1|9,2467,1">
                <select class="form-control pattern-select btn-info" id="selector" onchange="test()">
                    <option value="3,-2,3|1,-3,3|4,-2,3|5,-3,3|5,-5,3|4,-6,3|2,-6,3|1,-5,3|3,-4,3|2,-2,3|1,-4,3|5,-4,3|3,-12,3|4,-3,2|3,-8,2|9,2466,2|3,-3,1|3,-9,1|9,2467,1" selected>Cole's Cool Rule Shooter</option>
                    <option value="0,0,1|1,0,1|0,1,1|1,1,1|0,2,1|1,2,1|-1,4,1|2,4,1|-1,5,1|2,5,1">Milo's Symetrical Pattern</option>
                    <option value="2,1,1|-1,-2,1|0,-1,1|-1,-1,1|-1,0,1|0,0,1|0,-2,1|2,2,1|2,3,1|-3,1,1|-3,2,1|-3,3,1">Cole's Cool Pattern</option>
                    <option value="0,1,1|1,1,1|-1,2,1|-1,3,1|0,4,1|1,4,1|2,3,1|2,2,1">Life Diabolical Box</option>
                </select>
                <button id="set-pattern-button" type="button" onclick="submitpat()" class="btn btn-success">Set Pattern</button>


            </div>
        </div>


        <div class="canvas-cont-big fse-EditorPanel" style="overflow:hidden">
            <div class="fs-Toolbar options-toolbar canvas-toolbar" style="overflow:hidden">
              <div class="tool-item-row">

                  <div class="tool-item-button play-pause-button" onclick="toggleCalc()"><i class="fa fa-play"></i><i class="fa fa-pause"></i></div>
                  <div class="tool-item-button selected" value="pencil" onclick="selectTool('pencil')"><i class="fa fa-pencil"></i></div>
                  <div class="tool-item-button" value="pick" onclick="selectTool('pick')"><i class="fa fa-eyedropper"></i></div>
                  <div class="tool-item-button" value="select" onclick="selectTool('select')"><i class="fa fa-object-ungroup"></i></div>
                  <div class="tool-item-button" value="move" onclick="selectTool('move')"><i class="fa fa-hand-rock-o"></i></div>
                  <div class="tool-item-button" onclick="scrollX=0;scrollY=0;">
                  <i class="fa fa-crosshairs" aria-hidden="true"></i></div>
                </div>
                  <div class="tool-item-row">
                    <div class="tool-item-label-column"><div class="label">State:</div><div class="label">Color:</div></div>
                    <div class="tool-item-state-selection"></div>
                  </div>


            </div>
            <div class="canvas-cont">
                <canvas id="c" onmousedown="startDrag(event)" onmousemove="drag(event)" onmouseup="mouseUp()" onmouseleave="mouseUp()"></canvas>
            </div>
        </div>

        <script src="Basic Rules.js"></script>
        <script src="script.js">

        </script>
        <script class="rule-script"></script>

    </body>

</html>
